<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Dynamic keys for Azure - joserfc</title>
    <link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" /><link rel="next" title="Using OpenSSL command" href="../openssl/" /><link rel="prev" title="Migrating from PyJWT" href="../../migrations/pyjwt/" />
    <link rel="canonical" href="https://jose.authlib.org/en/dev/recipes/azure/" />
  <script>
    const isDarkTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const sessionTheme = sessionStorage['_theme']
    if (sessionTheme) {
      document.documentElement.classList.add(sessionTheme)
    } else if (isDarkTheme) {
      document.documentElement.classList.add('dark')
    }
  </script><link rel="shortcut icon" href="../../_static/icon.svg"/><link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <style>
:root {
  --sy-f-sys:-apple-system, BlinkMacSystemFont, Segoe UI, Oxygen, Ubuntu, Droid Sans, Helvetica Neue;--sy-f-cjk:PingFang SC, Hiragino Sans GB, Droid Sans Fallback, Microsoft YaHei;--sy-f-heading:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-text:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-mono:Menlo, Monaco, Consolas, "Courier New", monospace;--sy-c-divider:rgba(var(--sy-rc-text), 0.1);--sy-c-divider-weak:rgba(var(--sy-rc-text), 0.05);--sy-c-border:rgba(var(--sy-rc-text), 0.14);--sy-s-banner-height:0rem;--sy-s-navbar-height:56px;--sy-s-offset-top:calc(var(--sy-s-navbar-height) + var(--sy-s-banner-height));--sy-c-link:rgb(var(--sy-rc-theme));--sy-c-link-weak:rgba(var(--sy-rc-theme), 0.86);
  --sy-rc-theme:62,127,203;--sy-rc-bg:255, 255, 255;--sy-rc-invert:0, 0, 0;--sy-rc-text:0, 0, 0;--sy-c-bg:#fff;--sy-c-bg-weak:#f9f9f9;--sy-c-text:#374151;--sy-c-text-weak:#6b7280;--sy-c-heading:#111827;--sy-c-bold:#111827;--sy-c-foot-text:#232226;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f0f0f0;
}
@media (prefers-color-scheme: light) {
  :root {
    --sy-rc-theme:62,127,203;--sy-rc-bg:255, 255, 255;--sy-rc-invert:0, 0, 0;--sy-rc-text:0, 0, 0;--sy-c-bg:#fff;--sy-c-bg-weak:#f9f9f9;--sy-c-text:#374151;--sy-c-text-weak:#6b7280;--sy-c-heading:#111827;--sy-c-bold:#111827;--sy-c-foot-text:#232226;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f0f0f0;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --sy-rc-theme:102,173,255;--sy-rc-bg:18, 18, 18;--sy-rc-invert:255, 255, 255;--sy-rc-text:255, 255, 255;--sy-c-bg:#121212;--sy-c-bg-weak:#212833;--sy-c-text:#cedbea;--sy-c-text-weak:#77889f;--sy-c-heading:#ebf0f4;--sy-c-bold:#ebf0f4;--sy-c-foot-text:#eee;--sy-c-foot-bg:#000;--sy-c-foot-divider:#000;
  }
}
html.light {
  --sy-rc-theme:62,127,203;--sy-rc-bg:255, 255, 255;--sy-rc-invert:0, 0, 0;--sy-rc-text:0, 0, 0;--sy-c-bg:#fff;--sy-c-bg-weak:#f9f9f9;--sy-c-text:#374151;--sy-c-text-weak:#6b7280;--sy-c-heading:#111827;--sy-c-bold:#111827;--sy-c-foot-text:#232226;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f0f0f0;
}
html.dark {
  --sy-rc-theme:102,173,255;--sy-rc-bg:18, 18, 18;--sy-rc-invert:255, 255, 255;--sy-rc-text:255, 255, 255;--sy-c-bg:#121212;--sy-c-bg-weak:#212833;--sy-c-text:#cedbea;--sy-c-text-weak:#77889f;--sy-c-heading:#ebf0f4;--sy-c-bold:#ebf0f4;--sy-c-foot-text:#eee;--sy-c-foot-bg:#000;--sy-c-foot-divider:#000;
}
</style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: Inter, var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
<meta property="og:url" content="https://jose.authlib.org/en/dev/recipes/azure/"/>
<meta property="og:title" content="Dynamic keys for Azure"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@lepture"/>
<meta name="twitter:site" content="@authlib"/>
        <link rel="alternate" hreflang="zh" href="https://jose.authlib.org/zh/dev/recipes/azure/" />
  </head>
<body><div class="document"><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="../../">
      <img class="light-logo" src="../../_static/light-logo.svg" alt="joserfc" height="28" />
      <img class="dark-logo" src="../../_static/dark-logo.svg" alt="joserfc" height="28" />
      <strong>joserfc</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav">

<ul>
      <li class="link"><button type="button">
            <span>Projects</span>
            <i class="i-icon chevron"></i>
          </button>
        <ul>
          <li><a href="https://authlib.org/">
                <span>Authlib</span>
                <small>OAuth, JOSE, OpenID, etc.</small>
              </a></li><li><a href="https://jose.authlib.org/">
                <span>JOSE RFC</span>
                <small>JWS, JWE, JWK, and JWT.</small>
              </a></li><li><a href="https://otp.authlib.org/">
                <span>OTP Auth</span>
                <small>One time password, HOTP/TOTP.</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/authlib"><span>Sponsor me</span><i class="i-icon external-link"></i></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search/" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
<div class="nav-languages">
  <button type="button">
    <span class="md:hidden">Translations</span>
    <i class="i-icon languages"></i>
  </button>
  <div class="nav-languages-choices">
    <ul><li><a href="https://jose.authlib.org/en/dev/recipes/azure/">English</a></li><li><a href="https://jose.authlib.org/zh/dev/recipes/azure/">简体中文</a></li></ul>
  </div>
</div>

        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/authlib/joserfc" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
            <a class="flex items-center" href="https://discord.gg/HvBVAeNAaV" aria-label="Discord">
              <i class="i-icon discord"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center" data-aria-light="Switch to dark mode" data-aria-dark="Switch to light mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/">Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../guide/jwk/">JSON Web Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guide/jwt/">JSON Web Token</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guide/jws/">JSON Web Signature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guide/jwe/">JSON Web Encryption</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/algorithms/">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/registry/">Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrations/">Migrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migrations/authlib/">Migrating from Authlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migrations/pyjwt/">Migrating from PyJWT</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recipes</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dynamic keys for Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openssl/">Using OpenSSL command</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/jws/">JWS API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/jwe/">JWE API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/jwk/">JWK API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/jwt/">JWT API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stability/">API stability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/structure/">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/translation/">Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/authors/">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/sponsors/">Sponsors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/">Changelog</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4">
  <div class="localtoc">
    <h3>On this page</h3>
    <ul>
<li><a class="reference internal" href="#steps-for-decoding">Steps for decoding</a><ul>
<li><a class="reference internal" href="#openid-configuration-endpoint">OpenID Configuration Endpoint</a></li>
<li><a class="reference internal" href="#jwk-set-uri">JWK Set URI</a></li>
<li><a class="reference internal" href="#validating-jwt-tokens">Validating JWT Tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-a-callable-key">Using a Callable Key</a></li>
<li><a class="reference internal" href="#manual-token-decoding">Manual Token Decoding</a></li>
</ul>

  </div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/authlib/joserfc"
  data-type="github" data-user="authlib" data-repo="joserfc">
  <span class="w-8 flex items-center justify-around shrink-0 text-2xl">
    <i class="i-icon github"></i>
  </span>
  <span class="flex-grow px-2">
    <span>authlib/joserfc</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <i class="i-icon star"></i>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <i class="i-icon git-fork"></i>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/authlib/joserfc/blob/master/docs/recipes/azure.rst">Edit this page</a>
</div>
<script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7DKK3W&placement=joseauthliborg" id="_carbonads_js"></script><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../">joserfc</a><span>/</span></li>
      
      <li><strong>Dynamic keys for Azure</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="dynamic-keys-for-azure">
<h1>Dynamic keys for Azure<a class="headerlink" href="#dynamic-keys-for-azure" title="Permalink to this heading">¶</a></h1>
<p>In scenarios where you need to decode a JWT received from Azure (Microsoft), you
may encounter a situation where you are unaware of the public key required for the
decoding process until after the token arrives. In such cases, you will typically
need to retrieve the key set dynamically from the <code class="docutils literal notranslate"><span class="pre">iss</span></code> (issuer) value contained
within the JWT.</p>
<p>Let’s illustrate this process using a JWT token extracted from Microsoft’s official
documentation <a class="reference external" href="ms_doc_url">Access tokens in the Microsoft identity platform</a>:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span><span id="1-1">eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imk2bEdrM0ZaenhSY1ViMkMzbkVRN3N5SEpsWSJ9
</span><span id="1-2">.eyJhdWQiOiI2ZTc0MTcyYi1iZTU2LTQ4NDMtOWZmNC1lNjZhMzliYjEyZTMiLCJpc3MiOiJodHRwczovL2x
</span><span id="1-3">vZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3L3Y
</span><span id="1-4">yLjAiLCJpYXQiOjE1MzcyMzEwNDgsIm5iZiI6MTUzNzIzMTA0OCwiZXhwIjoxNTM3MjM0OTQ4LCJhaW8iOiJ
</span><span id="1-5">BWFFBaS84SUFBQUF0QWFaTG8zQ2hNaWY2S09udHRSQjdlQnE0L0RjY1F6amNKR3hQWXkvQzNqRGFOR3hYZDZ
</span><span id="1-6">3TklJVkdSZ2hOUm53SjFsT2NBbk5aY2p2a295ckZ4Q3R0djMzMTQwUmlvT0ZKNGJDQ0dWdW9DYWcxdU9UVDI
</span><span id="1-7">yMjIyZ0h3TFBZUS91Zjc5UVgrMEtJaWpkcm1wNjlSY3R6bVE9PSIsImF6cCI6IjZlNzQxNzJiLWJlNTYtNDg
</span><span id="1-8">0My05ZmY0LWU2NmEzOWJiMTJlMyIsImF6cGFjciI6IjAiLCJuYW1lIjoiQWJlIExpbmNvbG4iLCJvaWQiOiI
</span><span id="1-9">2OTAyMjJiZS1mZjFhLTRkNTYtYWJkMS03ZTRmN2QzOGU0NzQiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJhYmV
</span><span id="1-10">saUBtaWNyb3NvZnQuY29tIiwicmgiOiJJIiwic2NwIjoiYWNjZXNzX2FzX3VzZXIiLCJzdWIiOiJIS1pwZmF
</span><span id="1-11">IeVdhZGVPb3VZbGl0anJJLUtmZlRtMjIyWDVyclYzeERxZktRIiwidGlkIjoiNzJmOTg4YmYtODZmMS00MWF
</span><span id="1-12">mLTkxYWItMmQ3Y2QwMTFkYjQ3IiwidXRpIjoiZnFpQnFYTFBqMGVRYTgyUy1JWUZBQSIsInZlciI6IjIuMCJ9
</span><span id="1-13">.pj4N-w_3Us9DrBLfpCt
</span></pre></div>
</div>
<p>This token, obtained from Microsoft’s official documentation, serves as an example for
decoding JWTs originating from Azure. The decoded payload might look like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="p">{</span>
</span><span id="1-2"><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6e74172b-be56-4843-9ff4-e66a39bb12e3&quot;</span><span class="p">,</span>
</span><span id="1-3"><span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/v2.0&quot;</span><span class="p">,</span>
</span><span id="1-4"><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1537231048</span><span class="p">,</span>
</span><span id="1-5"><span class="w">  </span><span class="nt">&quot;nbf&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1537231048</span><span class="p">,</span>
</span><span id="1-6"><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1537234948</span><span class="p">,</span>
</span><span id="1-7"><span class="w">  </span><span class="nt">&quot;aio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AXQAi/8IAAAAtAaZLo3ChMif6KOnttRB7eBq4/DccQzjcJGxPYy/C3jDa...&quot;</span><span class="p">,</span>
</span><span id="1-8"><span class="w">  </span><span class="nt">&quot;azp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6e74172b-be56-4843-9ff4-e66a39bb12e3&quot;</span><span class="p">,</span>
</span><span id="1-9"><span class="w">  </span><span class="nt">&quot;azpacr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="1-10"><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Abe Lincoln&quot;</span><span class="p">,</span>
</span><span id="1-11"><span class="w">  </span><span class="nt">&quot;oid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;690222be-ff1a-4d56-abd1-7e4f7d38e474&quot;</span><span class="p">,</span>
</span><span id="1-12"><span class="w">  </span><span class="nt">&quot;preferred_username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abeli@microsoft.com&quot;</span><span class="p">,</span>
</span><span id="1-13"><span class="w">  </span><span class="nt">&quot;rh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;I&quot;</span><span class="p">,</span>
</span><span id="1-14"><span class="w">  </span><span class="nt">&quot;scp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;access_as_user&quot;</span><span class="p">,</span>
</span><span id="1-15"><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HKZpfaHyWadeOouYlitjrI-KffTm222X5rrV3xDqfKQ&quot;</span><span class="p">,</span>
</span><span id="1-16"><span class="w">  </span><span class="nt">&quot;tid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;72f988bf-86f1-41af-91ab-2d7cd011db47&quot;</span><span class="p">,</span>
</span><span id="1-17"><span class="w">  </span><span class="nt">&quot;uti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fqiBqXLPj0eQa82S-IYFAA&quot;</span><span class="p">,</span>
</span><span id="1-18"><span class="w">  </span><span class="nt">&quot;ver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
</span><span id="1-19"><span class="p">}</span>
</span></pre></div>
</div>
<section id="steps-for-decoding">
<h2>Steps for decoding<a class="headerlink" href="#steps-for-decoding" title="Permalink to this heading">¶</a></h2>
<p>In order to decode JWT tokens from Azure, it is essential to retrieve the necessary
information from Microsoft’s OpenID configuration, including the JSON Web Key Set (JWK Set)
URI. This information is crucial for verifying the tokens.</p>
<section id="openid-configuration-endpoint">
<h3>OpenID Configuration Endpoint<a class="headerlink" href="#openid-configuration-endpoint" title="Permalink to this heading">¶</a></h3>
<p>You can obtain the OpenID configuration endpoint from Microsoft by forming a URL in
the following format:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span><span id="1-1">https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration
</span></pre></div>
</div>
<p>In the example provided, replace {tenant} with your specific Azure tenant ID or
the tenant’s globally unique identifier (GUID). The resulting URL will lead you
to the OpenID configuration details. Then, the OpenID configuration endpoint for
the above example could be:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span><span id="1-1">https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/v2.0/.well-known/openid-configuration
</span></pre></div>
</div>
</section>
<section id="jwk-set-uri">
<h3>JWK Set URI<a class="headerlink" href="#jwk-set-uri" title="Permalink to this heading">¶</a></h3>
<p>Within the OpenID configuration details, you will find the JSON Web Key Set (JWK Set) URI.
This URI is used to access the keys required for verifying JWT tokens. The JWK Set URI
can typically be found within the configuration as follows:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span><span id="1-1">https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys
</span></pre></div>
</div>
<p>Once again, remember to replace {tenant} with your Azure tenant ID or the appropriate identifier.
In the above example, the <code class="docutils literal notranslate"><span class="pre">jwks_uri</span></code> could be:</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span><span id="1-1">https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/discovery/v2.0/keys
</span></pre></div>
</div>
</section>
<section id="validating-jwt-tokens">
<h3>Validating JWT Tokens<a class="headerlink" href="#validating-jwt-tokens" title="Permalink to this heading">¶</a></h3>
<p>Once you have retrieved the JSON Web Key Set (JWK Set) from the JWK Set URI provided in the
OpenID configuration, you can proceed to validate JWT tokens.</p>
</section>
</section>
<section id="using-a-callable-key">
<h2>Using a Callable Key<a class="headerlink" href="#using-a-callable-key" title="Permalink to this heading">¶</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">joserfc</span></code>, a callable key is a powerful feature that allows you to dynamically retrieve
and use the appropriate JSON Web Key (JWK) for token decoding. In the context of Azure tokens,
you can implement a callable key to fetch the JWKs from the JWK Set URI and select the correct
key based on the kid (Key ID) in the token’s header.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="kn">import</span> <span class="nn">json</span>
</span><span id="1-2"><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="1-3"><span class="kn">from</span> <span class="nn">joserfc.jws</span> <span class="kn">import</span> <span class="n">CompactSignature</span>
</span><span id="1-4"><span class="kn">from</span> <span class="nn">joserfc.jwk</span> <span class="kn">import</span> <span class="n">KeySet</span>
</span><span id="1-5"><span class="kn">from</span> <span class="nn">joserfc</span> <span class="kn">import</span> <span class="n">jwt</span>
</span><span id="1-6">
</span><span id="1-7"><span class="k">def</span> <span class="nf">load_key</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">CompactSignature</span><span class="p">):</span>
</span><span id="1-8">    <span class="n">claims</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</span><span id="1-9">    <span class="n">issuer_url</span> <span class="o">=</span> <span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">]</span>
</span><span id="1-10">
</span><span id="1-11">    <span class="c1"># retrieve OpenID Configuration Endpoint</span>
</span><span id="1-12">    <span class="n">openid_configuration_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">issuer_url</span><span class="si">}</span><span class="s1">/.well-known/openid-configuration&#39;</span>
</span><span id="1-13">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">openid_configuration_endpoint</span><span class="p">)</span>
</span><span id="1-14">
</span><span id="1-15">    <span class="c1"># retrieve JWK Set URI</span>
</span><span id="1-16">    <span class="n">jwks_uri</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;jwks_uri&#39;</span><span class="p">]</span>
</span><span id="1-17">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">jwks_uri</span><span class="p">)</span>
</span><span id="1-18">
</span><span id="1-19">    <span class="c1"># pick the key with kid</span>
</span><span id="1-20">    <span class="n">key_set</span> <span class="o">=</span> <span class="n">KeySet</span><span class="o">.</span><span class="n">import_key_set</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="1-21">    <span class="n">key</span> <span class="o">=</span> <span class="n">key_set</span><span class="o">.</span><span class="n">get_by_kid</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">headers</span><span class="p">()[</span><span class="s1">&#39;kid&#39;</span><span class="p">])</span>
</span><span id="1-22">    <span class="k">return</span> <span class="n">key</span>
</span><span id="1-23">
</span><span id="1-24"><span class="c1"># pass load_key as a callable key to `jwt.decode` method</span>
</span><span id="1-25"><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token_string</span><span class="p">,</span> <span class="n">load_key</span><span class="p">)</span>
</span></pre></div>
</div>
<p>When using the callable key method in <code class="docutils literal notranslate"><span class="pre">joserfc</span></code> to decode the tokens, it retrieves
the key dynamically on each token decoding request. However, you may encounter performance
issues due to the repeated retrieval of keys. In such cases, it’s advisable to optimize
the callable key by implementing key set caching based on the issuer.</p>
<p>Let’s enhance the callable key method to improve its efficiency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
</span><span id="1-2">
</span><span id="1-3"><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-4"><span class="k">def</span> <span class="nf">fetch_key_set</span><span class="p">(</span><span class="n">issuer</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-5">    <span class="n">openid_configuration_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">issuer</span><span class="si">}</span><span class="s1">/.well-known/openid-configuration&#39;</span>
</span><span id="1-6">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">openid_configuration_endpoint</span><span class="p">)</span>
</span><span id="1-7">    <span class="n">jwks_uri</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;jwks_uri&#39;</span><span class="p">]</span>
</span><span id="1-8">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">jwks_uri</span><span class="p">)</span>
</span><span id="1-9">    <span class="k">return</span> <span class="n">KeySet</span><span class="o">.</span><span class="n">import_key_set</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="1-10">
</span><span id="1-11"><span class="k">def</span> <span class="nf">load_key</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">CompactSignature</span><span class="p">):</span>
</span><span id="1-12">    <span class="n">claims</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</span><span id="1-13">    <span class="n">key_set</span> <span class="o">=</span> <span class="n">fetch_key_set</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>
</span><span id="1-14">    <span class="n">key</span> <span class="o">=</span> <span class="n">key_set</span><span class="o">.</span><span class="n">get_by_kid</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">headers</span><span class="p">()[</span><span class="s1">&#39;kid&#39;</span><span class="p">])</span>
</span><span id="1-15">    <span class="k">return</span> <span class="n">key</span>
</span></pre></div>
</div>
<p>In this enhanced callable key, an LRU (Least Recently Used) cache is used to store
JWK Sets for different issuers. When decoding a token, the callable key function first
checks if the JWK Set for the specific issuer is available in the cache. If it’s not,
it fetches the JWK Set for the issuer, caches it, and then selects the appropriate JWK
based on the kid. This caching mechanism significantly reduces the network requests for
JWK Sets and improves the efficiency of token decoding.</p>
</section>
<section id="manual-token-decoding">
<h2>Manual Token Decoding<a class="headerlink" href="#manual-token-decoding" title="Permalink to this heading">¶</a></h2>
<p>If you prefer a more hands-on approach and want to decode the token step by step,
you can opt for a manual decoding process. This method allows you to extract the
token string and work with it directly. Since the token is a JWT in JWS format,
you can utilize the <code class="docutils literal notranslate"><span class="pre">extract_compact</span></code> method from the JWS module to obtain the
necessary information. The result of this extraction is an object of type
<a class="reference internal" href="../../api/jws/#joserfc.jws.CompactSignature" title="joserfc.jws.CompactSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompactSignature</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="kn">from</span> <span class="nn">joserfc.jws</span> <span class="kn">import</span> <span class="n">extract_compact</span><span class="p">,</span> <span class="n">CompactSignature</span>
</span><span id="1-2">
</span><span id="1-3"><span class="n">obj</span><span class="p">:</span> <span class="n">CompactSignature</span> <span class="o">=</span> <span class="n">extract_compact</span><span class="p">(</span><span class="n">token_string</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Similar to the approach detailed in the “Using a Callable Key” section, you can
retrieve the key set based on the issuer (<code class="docutils literal notranslate"><span class="pre">iss</span></code>) claim. This method allows you to
access the necessary keys for token verification.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-2"><span class="k">def</span> <span class="nf">fetch_key_set</span><span class="p">(</span><span class="n">issuer</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-3">    <span class="n">openid_configuration_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">issuer</span><span class="si">}</span><span class="s1">/.well-known/openid-configuration&#39;</span>
</span><span id="1-4">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">openid_configuration_endpoint</span><span class="p">)</span>
</span><span id="1-5">    <span class="n">jwks_uri</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;jwks_uri&#39;</span><span class="p">]</span>
</span><span id="1-6">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">jwks_uri</span><span class="p">)</span>
</span><span id="1-7">    <span class="k">return</span> <span class="n">KeySet</span><span class="o">.</span><span class="n">import_key_set</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span id="1-8">
</span><span id="1-9"><span class="n">claims</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</span><span id="1-10"><span class="n">key_set</span> <span class="o">=</span> <span class="n">fetch_key_set</span><span class="p">(</span><span class="n">claims</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">])</span>
</span></pre></div>
</div>
<p>Once you have obtained the key set based on the issuer (<code class="docutils literal notranslate"><span class="pre">iss</span></code>) claim, you can use this
set of keys to decode the token.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span id="1-1"><span class="kn">from</span> <span class="nn">joserfc</span> <span class="kn">import</span> <span class="n">jwt</span>
</span><span id="1-2">
</span><span id="1-3"><span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token_string</span><span class="p">,</span> <span class="n">key_set</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>

        </article>
        
        <div class="navigation flex print:hidden">
  <div class="navigation-prev">
    <a href="../../migrations/pyjwt/">
      <i class="i-icon chevron"></i>
      <div class="page-info">
        <span>Previous</span>
        
        <div class="title">Migrating from PyJWT</div>
        
      </div>
    </a>
  </div>
  <div class="navigation-next">
    <a href="../openssl/">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Using OpenSSL command</div>
      </div>
      <i class="i-icon chevron"></i>
    </a>
  </div>
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>Copyright &copy; 2023, Hsiaoming Yang</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/authlib/joserfc" aria-label="GitHub"><i class="i-icon github"></i></a>
          <a href="https://twitter.com/authlib" aria-label="Twitter"><i class="i-icon twitter"></i></a>
          <a href="https://discord.gg/HvBVAeNAaV" aria-label="Discord"><i class="i-icon discord"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
      <script src="../../_static/clipboard.min.js"></script>
      <script src="../../_static/copybutton.js"></script>
      <script src="../../_static/design-tabs.js"></script>
      <script src="../../_static/shibuya.js"></script>
    
</body>
</html>